<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Word Timing Editor - Component 4: Audio Preview v2.5</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .help-text {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #166534;
        }
        
        .segment-test {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .segment-test h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .segment-player {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .segment-title {
            font-weight: 600;
            color: #2d3748;
        }
        
        .segment-time {
            font-size: 12px;
            color: #64748b;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .segment-text {
            color: #4b5563;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .playback-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            background: #4338ca;
        }
        
        .btn.secondary {
            background: #6b7280;
        }
        
        .btn.secondary:hover {
            background: #4b5563;
        }
        
        .btn.playing {
            background: #10b981;
        }
        
        .btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }
        
        .time-display {
            background: #f1f5f9;
            padding: 6px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            min-width: 120px;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: #4f46e5;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .status {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            color: #0c4a6e;
        }
        
        .audio-status {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            color: #92400e;
            margin-top: 8px;
        }
        
        .audio-status.success {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        
        .audio-status.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üïê Timeline Word Timing Editor</h1>
            <p>Component 4 v2.5: Independent Audio Segment Testing</p>
        </div>
        
        <div class="help-text">
            <strong>üéØ How to use:</strong> Test each segment independently ‚Ä¢ Click play to hear audio ‚Ä¢ Status shows loading/playing/error ‚Ä¢ Progress bar for seeking
        </div>
        
        <div class="segment-test">
            <h3>üéµ Independent Segment Audio Testing</h3>
            <div id="segmentPlayers">
                <!-- Segment players will be populated here -->
            </div>
        </div>
        
        <div class="status">
            ‚úÖ Component 4 v2.5: Testing individual segment audio playback
        </div>
    </div>

    <script>
        // Your actual episode content segments with audio paths
        let segments = [
            {
                id: 1,
                text: "Welcome to Life is Your Word episode 3.",
                startTime: 7.68,
                endTime: 10.7,
                audioUrl: "/home/asabaal/episode3_combined/audio/segment1.m4a"
            },
            {
                id: 2,
                text: "In this show, we build up our understanding of reality by seeking God's face.",
                startTime: 11.68,
                endTime: 17.7,
                audioUrl: "/home/asabaal/episode3_combined/audio/segment2.m4a"
            },
            {
                id: 3,
                text: "Today's reading is from Genesis chapter 1.",
                startTime: 20.44,
                endTime: 22.46,
                audioUrl: "/home/asabaal/episode3_combined/audio/segment3.m4a"
            },
            {
                id: 4,
                text: "When God began to create the heavens and the earth, the earth was in complete chaos and",
                startTime: 27.2,
                endTime: 34.11,
                audioUrl: "/home/asabaal/episode3_combined/audio/segment4.m4a"
            }
        ];
        
        // Store audio elements for each segment
        let segmentAudioElements = {};
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function renderSegmentPlayers() {
            const container = document.getElementById('segmentPlayers');
            container.innerHTML = '';
            
            segments.forEach(segment => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'segment-player';
                playerDiv.innerHTML = `
                    <div class="segment-header">
                        <div class="segment-title">Segment ${segment.id}</div>
                        <div class="segment-time">${formatTime(segment.startTime)} - ${formatTime(segment.endTime)}</div>
                    </div>
                    <div class="segment-text">${segment.text}</div>
                    <div class="playback-controls">
                        <button class="btn" id="playBtn-${segment.id}" onclick="toggleSegmentPlay(${segment.id})" disabled>‚ñ∂Ô∏è Play</button>
                        <button class="btn secondary" id="stopBtn-${segment.id}" onclick="stopSegment(${segment.id})" disabled>‚èπÔ∏è Stop</button>
                        <div class="time-display" id="timeDisplay-${segment.id}">0:00 / 0:00</div>
                    </div>
                    <div class="progress-bar" id="progressBar-${segment.id}" onclick="seekSegment(${segment.id}, event)">
                        <div class="progress-fill" id="progressFill-${segment.id}"></div>
                    </div>
                    <div class="audio-status" id="audioStatus-${segment.id}">Loading audio...</div>
                `;
                
                container.appendChild(playerDiv);
                
                // Initialize audio for this segment
                initializeSegmentAudio(segment);
            });
        }
        
        function initializeSegmentAudio(segment) {
            const audio = new Audio(segment.audioUrl);
            segmentAudioElements[segment.id] = audio;
            
            audio.addEventListener('loadedmetadata', () => {
                const duration = audio.duration;
                document.getElementById(`timeDisplay-${segment.id}`).textContent = `0:00 / ${formatTime(duration)}`;
                document.getElementById(`playBtn-${segment.id}`).disabled = false;
                document.getElementById(`stopBtn-${segment.id}`).disabled = false;
                document.getElementById(`audioStatus-${segment.id}`).textContent = `Audio loaded (${formatTime(duration)})`;
                document.getElementById(`audioStatus-${segment.id}`).className = 'audio-status success';
                console.log(`Segment ${segment.id} audio loaded: ${duration}s`);
            });
            
            audio.addEventListener('timeupdate', () => {
                const currentTime = audio.currentTime;
                const duration = audio.duration;
                const percentage = (currentTime / duration) * 100;
                
                document.getElementById(`progressFill-${segment.id}`).style.width = percentage + '%';
                document.getElementById(`timeDisplay-${segment.id}`).textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
            });
            
            audio.addEventListener('ended', () => {
                stopSegment(segment.id);
            });
            
            audio.addEventListener('error', (e) => {
                console.error(`Error loading segment ${segment.id}:`, e);
                document.getElementById(`audioStatus-${segment.id}`).textContent = `Error loading audio: ${e.message || 'File not found'}`;
                document.getElementById(`audioStatus-${segment.id}`).className = 'audio-status error';
                document.getElementById(`playBtn-${segment.id}`).disabled = true;
                document.getElementById(`stopBtn-${segment.id}`).disabled = true;
            });
        }
        
        function toggleSegmentPlay(segmentId) {
            const audio = segmentAudioElements[segmentId];
            const playBtn = document.getElementById(`playBtn-${segmentId}`);
            
            if (!audio) return;
            
            if (audio.paused) {
                // Stop all other segments first
                Object.keys(segmentAudioElements).forEach(id => {
                    if (id != segmentId) {
                        stopSegment(parseInt(id));
                    }
                });
                
                audio.play().then(() => {
                    playBtn.textContent = '‚è∏Ô∏è Pause';
                    playBtn.classList.add('playing');
                    document.getElementById(`audioStatus-${segmentId}`).textContent = 'Playing...';
                }).catch(e => {
                    console.error(`Error playing segment ${segmentId}:`, e);
                    document.getElementById(`audioStatus-${segmentId}`).textContent = `Error playing: ${e.message}`;
                    document.getElementById(`audioStatus-${segmentId}`).className = 'audio-status error';
                });
            } else {
                audio.pause();
                playBtn.textContent = '‚ñ∂Ô∏è Play';
                playBtn.classList.remove('playing');
                document.getElementById(`audioStatus-${segmentId}`).textContent = 'Paused';
            }
        }
        
        function stopSegment(segmentId) {
            const audio = segmentAudioElements[segmentId];
            const playBtn = document.getElementById(`playBtn-${segmentId}`);
            
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
            }
            
            if (playBtn) {
                playBtn.textContent = '‚ñ∂Ô∏è Play';
                playBtn.classList.remove('playing');
            }
            
            document.getElementById(`progressFill-${segmentId}`).style.width = '0%';
            document.getElementById(`timeDisplay-${segmentId}`).textContent = `0:00 / ${formatTime(audio?.duration || 0)}`;
            document.getElementById(`audioStatus-${segmentId}`).textContent = 'Stopped';
            document.getElementById(`audioStatus-${segmentId}`).className = 'audio-status';
        }
        
        function seekSegment(segmentId, event) {
            const audio = segmentAudioElements[segmentId];
            if (!audio) return;
            
            const progressBar = document.getElementById(`progressBar-${segmentId}`);
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            audio.currentTime = percentage * audio.duration;
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            renderSegmentPlayers();
        });
    </script>
</body>
</html>